install.packages("installr")
library(installr)
find_rtools()
Sys.getenv("PATH")

library(udpipe)

# use this model, because the other one can't handle gendered language
dl <- udpipe_download_model(language = "german-gsd")

udmodel_german <- udpipe_load_model(file = dl$file_model)

x <- udpipe_annotate(udmodel_german, x = taz_subset$body)
x <- as.data.frame(x)
str(x)


## Tokenization + finds sentences, does not execute POS tagging, nor lemmatization or dependency parsing
x <- udpipe_annotate(udmodel_german, x = taz_subset$body, tagger = "none", parser = "none")
x <- as.data.frame(x)
tokenstaz<-table(x$token)


#----------------------------------------do the same for reference corpora

x <- udpipe_annotate(udmodel_german, x = sueddeutsche_subset$body)
x <- as.data.frame(x)
str(x)


## Tokenization + finds sentences, does not execute POS tagging, nor lemmatization or dependency parsing
x <- udpipe_annotate(udmodel_german, x = sueddeutsche_subset$body, tagger = "none", parser = "none")
x <- as.data.frame(x)
tokenssued<-table(x$token)

#-------------------------------------------loglikelyhood

termCountsTarget <- (tokenstaz)
termCountsComparison <- (tokenssueddeutsche)

logLikelihood <- calculateLogLikelihood(termCountsTarget, 
                                        termCountsComparison, 
                                        pattern = "Gender", 
                                        minSignificance = 6.63)
print(logLikelihood)

#irgendwie ist da ein fehler drin weil die tokenliste der taz und sueddeutschen
#in unterschiedlichen formaten vorliegt??
#jetzt sind die Asterixe drinn, 
#allerdings gibt es keine * Überschneidungen in den Texten, obwohl die eigentlich da sein sollten..z.B bei Bürger*
#eventuell sollte man dann die intersektion rausnehmen?
#sueddeutsche hat iregndwie alle sätze oft drinn
